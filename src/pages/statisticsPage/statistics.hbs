<div class="statistics-page">
    <div class="dashboard-header">
        <h1>Статистика обращений</h1>
    </div>
    
    <div class="stats-grid">
        <div class="stat-card">
            <h3>Всего обращений</h3>
            <div class="value">{{total_tickets}}</div>
        </div>
        <div class="stat-card" data-status="open">
            <h3>Открытые обращения</h3>
            <div class="value">{{tickets_by_status.open.absolute}}</div>
        </div>
        <div class="stat-card" data-status="work">
            <h3>В работе</h3>
            <div class="value">{{tickets_by_status.in_progress.absolute}}</div>
        </div>
        <div class="stat-card" data-status="closed">
            <h3>Завершенные обращения</h3>
            <div class="value">{{tickets_by_status.closed.absolute}}</div>
        </div>
    </div>
    
    <div class="charts-container">
        <div class="chart-card">
            <h2>Обращения по категориям</h2>
            <div class="chart-container">
                <div class="category-chart">
                    {{#each tickets_by_category}}
                    <div class="category-item" data-category="{{@key}}" data-count="{{this.absolute}}">
                        <div class="category-info">
                            <span class="category-name">{{@key}}</span>
                            <span class="category-count">{{this.absolute}}</span>
                        </div>
                        <div class="category-bar">
                            <div class="category-fill" style="--percentage: {{this.percentage}};"></div>
                        </div>
                        <div class="category-percentage">{{this.percentage}}%</div>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
        
        <div class="chart-card">
            <h2>Обращения по состояниям</h2>
            <div class="chart-container">
                <div class="status-chart">
                    {{#each tickets_by_status}}
                    <div class="status-item" data-status="{{@key}}">
                        <div class="status-info">
                            <span class="status-name">{{@key}}</span>
                            <span class="status-count">{{this.absolute}}</span>
                        </div>
                        <div class="status-visual">
                            <div class="status-circle" style="--percentage: {{this.percentage}};">
                                <span class="status-percentage">{{this.percentage}}%</span>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
    </div>
    
    <div class="response-time">
        <div class="response-time-content">
            <h2>Среднее время ответа</h2>
            <div class="time">{{average_response_time}}</div>
        </div>
    </div>

    <!-- New Tickets List Section -->
    <div class="tickets-list-section">
        <div class="section-header">
            <h2>Список всех обращений</h2>
        </div>
        
        <div class="tickets-table-container">
            <table class="tickets-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Категория</th>
                        <th>Текст обращения</th>
                        <th>Email</th>
                        <th>Статус</th>
                        <th>Дата создания</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each all_tickets}}
                    <tr class="ticket-row" data-status="{{this.status}}">
                        <td class="ticket-id">{{this.id}}</td>
                        <td class="ticket-category">
                            <span class="category-badge category-{{this.category}}">{{this.category}}</span>
                        </td>
                        <td class="ticket-text" data-fulltext="{{this.text}}">
                            <span class="text-truncated">{{this.text}}</span>
                        </td>
                        <td class="ticket-email">{{this.email}}</td>
                        <td class="ticket-status">
                            <span class="status-badge status-{{this.status}}">{{this.status}}</span>
                        </td>
                        <td class="ticket-date">{{this.created_at}}</td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </div>
</div>